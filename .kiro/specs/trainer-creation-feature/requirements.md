# Requirements Document

## はじめに

本仕様は、ユーザーが独自の推しトレーナーを作成できる機能を実装します。ホーム画面から「推しトレーナー作成」画面に遷移し、キャラクター画像、名前、イメージカラー、性格、ボイスなどの設定を入力・選択することで、パーソナライズされたトレーニングコンパニオンを作成できるようにします。

### ビジネス価値
- ユーザーエンゲージメントの向上: 自分だけの推しトレーナーを作成することで、アプリへの愛着が深まる
- トレーニング継続率の向上: 好みのキャラクターと一緒にトレーニングすることでモチベーションが維持される
- ユーザー体験のパーソナライゼーション: イメージカラーや性格に応じたUI/UXのカスタマイズ
- 既存のテンプレートシステムの活用: `OshiTrainerTemplate`を基盤とした実装

## 要件

### 要件1: 推しトレーナー作成画面への遷移
**目的:** トレーニングアプリのユーザーとして、ホーム画面から簡単に推しトレーナー作成画面にアクセスし、新しいトレーナーを追加できるようにする。

#### 受け入れ基準

1. WHEN ユーザーがホーム画面のキャラクタースワイプ領域を表示している場合、Oshi-Trainerシステム SHALL 「キャラ追加」画像を最後のトレーナーの次に表示する
2. WHEN ユーザーが「キャラ追加」画像をタップした場合、Oshi-Trainerシステム SHALL 推しトレーナー作成画面に遷移する
3. WHEN ユーザーがホーム画面の「推しトレーナー作成」ボタンをタップした場合、Oshi-Trainerシステム SHALL 推しトレーナー作成画面に遷移する
4. WHEN 推しトレーナー作成画面が表示される場合、Oshi-Trainerシステム SHALL タイトル「推しトレーナー作成」をピンクカラー（デフォルトトレーナーのテーマカラーと一致）で表示する

### 要件2: キャラクター画像の選択
**目的:** トレーニングアプリのユーザーとして、推しトレーナーのキャラクター画像を選択し、視覚的に魅力的なトレーナーを作成できるようにする。

#### 受け入れ基準

1. WHEN ユーザーが推しトレーナー作成画面を表示している場合、Oshi-Trainerシステム SHALL 「キャラ画像」選択フィールドを提供する
2. WHEN ユーザーが「キャラ画像」選択フィールドをタップした場合、Oshi-Trainerシステム SHALL デバイスの写真ライブラリまたはカメラから画像を選択するUIを表示する
3. WHEN ユーザーが画像を選択した場合、Oshi-Trainerシステム SHALL 選択された画像をプレビュー表示する
4. IF ユーザーが「キャラ画像」を未選択のまま保存しようとした場合、Oshi-Trainerシステム SHALL エラーメッセージ「キャラクター画像を選択してください」を表示し、作成を中止する
5. WHEN 選択された画像が背景透過PNG形式の場合、Oshi-Trainerシステム SHALL 透過部分を維持してホーム画面に表示する

### 要件3: 基本プロフィールの入力
**目的:** トレーニングアプリのユーザーとして、推しトレーナーの基本プロフィール（名前、イメージカラー、一人称、呼び方）を設定し、パーソナライズされたトレーナーを作成できるようにする。

#### 受け入れ基準

1. WHEN ユーザーが推しトレーナー作成画面を表示している場合、Oshi-Trainerシステム SHALL 「名前」入力フィールドを提供する
2. WHEN ユーザーが推しトレーナー作成画面を表示している場合、Oshi-Trainerシステム SHALL 「イメージカラー」選択フィールドを提供する
3. WHEN ユーザーが推しトレーナー作成画面を表示している場合、Oshi-Trainerシステム SHALL 「一人称」入力フィールド（例: うち、私、俺、僕）を提供する
4. WHEN ユーザーが推しトレーナー作成画面を表示している場合、Oshi-Trainerシステム SHALL 「呼び方」入力フィールド（ユーザーへの呼び方、例: あんた、あなた、君、お前）を提供する
5. IF ユーザーが「名前」を未入力のまま保存しようとした場合、Oshi-Trainerシステム SHALL エラーメッセージ「名前を入力してください」を表示し、作成を中止する
6. IF ユーザーが「イメージカラー」を未選択のまま保存しようとした場合、Oshi-Trainerシステム SHALL デフォルトカラー（ピンク）を自動設定する
7. IF ユーザーが「一人称」または「呼び方」を未入力のまま保存しようとした場合、Oshi-Trainerシステム SHALL 性格タイプに応じたデフォルト値を自動設定する

### 要件4: 性格の選択
**目的:** トレーニングアプリのユーザーとして、推しトレーナーの性格を選択し、トレーニング中のメッセージやセリフを性格に合わせてカスタマイズできるようにする。

#### 受け入れ基準

1. WHEN ユーザーが推しトレーナー作成画面を表示している場合、Oshi-Trainerシステム SHALL 「性格」選択フィールドを提供する
2. WHEN ユーザーが「性格」選択フィールドをタップした場合、Oshi-Trainerシステム SHALL 利用可能な性格タイプ一覧（優しい、元気、クール、ツンデレ、厳しい）を表示する
3. IF ユーザーが「性格」を未選択のまま保存しようとした場合、Oshi-Trainerシステム SHALL デフォルト性格（元気）を自動設定する
4. WHEN 推しトレーナーが作成された場合、Oshi-Trainerシステム SHALL 選択された性格タイプに基づいてテンプレートセリフを生成する

### 要件5: ボイスの選択とサンプル再生
**目的:** トレーニングアプリのユーザーとして、推しトレーナーのボイス（音声フィードバック）を選択し、サンプル音声を聞いて確認できるようにする。

#### 受け入れ基準

1. WHEN ユーザーが推しトレーナー作成画面を表示している場合、Oshi-Trainerシステム SHALL 「ボイス」選択フィールドを提供する
2. WHEN ユーザーが「ボイス」選択フィールドをタップした場合、Oshi-Trainerシステム SHALL 利用可能なボイス一覧（ずんだもん、四国めたん）を表示する
3. WHEN ユーザーがボイス一覧の各ボイスを表示している場合、Oshi-Trainerシステム SHALL 「サンプル再生」ボタンを提供する
4. WHEN ユーザーが「サンプル再生」ボタンをタップした場合、Oshi-Trainerシステム SHALL 選択されたボイスのランダムなサンプル音声（レップカウント、タイマー、フォームエラー、速度フィードバックのいずれか）を再生する
5. IF ユーザーが「ボイス」を未選択のまま保存しようとした場合、Oshi-Trainerシステム SHALL デフォルトボイス（ずんだもん）を自動設定する
6. WHEN サンプル音声が再生中の場合、Oshi-Trainerシステム SHALL 他のサンプル音声の再生を停止する

### 要件6: 推しトレーナーの作成と保存
**目的:** トレーニングアプリのユーザーとして、入力・選択した情報をもとに推しトレーナーを作成し、ホーム画面で使用できるようにする。

#### 受け入れ基準

1. WHEN ユーザーが推しトレーナー作成画面を表示している場合、Oshi-Trainerシステム SHALL 「作成」ボタンを提供する
2. WHEN ユーザーが「作成」ボタンをタップした場合、Oshi-Trainerシステム SHALL 入力検証を実行する
3. IF 入力検証が成功した場合、Oshi-Trainerシステム SHALL 新しい推しトレーナーをローカルストレージに保存する
4. WHEN 推しトレーナーが保存された場合、Oshi-Trainerシステム SHALL ホーム画面に戻る
5. WHEN 推しトレーナーが保存された場合、Oshi-Trainerシステム SHALL 作成された推しトレーナーを現在のアクティブトレーナーとして設定する
6. IF 入力検証が失敗した場合、Oshi-Trainerシステム SHALL エラーメッセージを表示し、作成画面に留まる

### 要件7: ホーム画面への反映とイメージカラーの適用
**目的:** トレーニングアプリのユーザーとして、作成した推しトレーナーがホーム画面に表示され、イメージカラーがUIに適用されることで、パーソナライズされた体験を得られるようにする。

#### 受け入れ基準

1. WHEN 新しい推しトレーナーが作成された場合、Oshi-Trainerシステム SHALL ホーム画面のキャラクタースワイプ領域に作成されたトレーナー画像を表示する
2. WHEN 新しい推しトレーナーが作成された場合、Oshi-Trainerシステム SHALL 作成されたトレーナーをアクティブトレーナーとして選択した状態で表示する
3. WHEN アクティブトレーナーのイメージカラーが設定されている場合、Oshi-Trainerシステム SHALL 以下のUI要素にイメージカラーを適用する:
   - 設定ボタン、推しボタン、統計ボタンのアクセントカラー
   - 背景グラデーションカラー
   - レベル詳細画面、統計画面、設定画面のタイトルテキスト
4. WHEN アクティブトレーナーの性格が設定されている場合、Oshi-Trainerシステム SHALL メッセージ欄に性格に合わせたセリフを表示する
5. WHEN アクティブトレーナーのボイスが設定されている場合、Oshi-Trainerシステム SHALL トレーニング中の音声フィードバックに設定されたボイスを使用する

### 要件8: 複数トレーナーの管理と表示順序
**目的:** トレーニングアプリのユーザーとして、複数の推しトレーナーを管理し、スワイプで切り替えられるようにする。

#### 受け入れ基準

1. WHEN ユーザーがホーム画面を表示している場合、Oshi-Trainerシステム SHALL トレーナーを以下の順序で表示する:
   - 1番目: デフォルトトレーナー「推乃 愛」
   - 2番目以降: ユーザーが作成したトレーナー（作成日時の古い順）
   - 最後: 「キャラ追加」画像
2. WHEN ユーザーがキャラクタースワイプ領域を左右にスワイプした場合、Oshi-Trainerシステム SHALL 次または前のトレーナーに切り替える
3. WHEN トレーナーが切り替わった場合、Oshi-Trainerシステム SHALL 新しいアクティブトレーナーのイメージカラーと性格に応じてUI要素とメッセージを更新する
4. WHEN 無限ループスワイプが有効な場合、Oshi-Trainerシステム SHALL トレーナーリストの最初と最後をシームレスに接続する

### 要件9: データモデルと既存システムとの統合
**目的:** 開発者として、既存の`OshiTrainerTemplate`モデルと`MockDataService`を活用し、推しトレーナー作成機能を既存アーキテクチャに統合する。

#### 受け入れ基準

1. WHEN 推しトレーナー作成機能を実装する場合、Oshi-Trainerシステム SHALL 既存の`OshiTrainerTemplate`モデルを使用してトレーナーデータを保存する
2. WHEN 推しトレーナー作成機能を実装する場合、Oshi-Trainerシステム SHALL 既存の`PersonalityType`, `EncouragementStyle`, `FeedbackFrequency`列挙型を使用する
3. WHEN トレーナーが作成された場合、Oshi-Trainerシステム SHALL `DataServiceProtocol`に準拠したサービスを通じてデータを保存する
4. WHEN トレーナーリストを取得する場合、Oshi-Trainerシステム SHALL `DataServiceProtocol`に準拠したサービスからデータを取得する
5. WHEN ホーム画面が表示される場合、Oshi-Trainerシステム SHALL 既存の`HomeViewModel`を拡張してトレーナーリストを管理する

### 要件10: UIコンポーネントとスタイリング
**目的:** 開発者として、既存のウマ娘風UIデザインシステムを活用し、一貫性のある推しトレーナー作成画面を実装する。

#### 受け入れ基準

1. WHEN 推しトレーナー作成画面を実装する場合、Oshi-Trainerシステム SHALL 既存の`OshiButtonStyle`を使用してボタンをスタイリングする
2. WHEN 推しトレーナー作成画面を実装する場合、Oshi-Trainerシステム SHALL 既存の`OshiTextStyles`を使用してテキストをスタイリングする
3. WHEN 推しトレーナー作成画面を実装する場合、Oshi-Trainerシステム SHALL 既存の`Color+Oshi`カラーパレットを使用して配色する
4. WHEN 推しトレーナー作成画面のタイトルを表示する場合、Oshi-Trainerシステム SHALL ピンクカラー（`.oshiPink`または`Color(red: 1.0, green: 0.4, blue: 0.6)`）を使用する
5. WHEN 推しトレーナー作成画面の背景を表示する場合、Oshi-Trainerシステム SHALL 既存の`oshiBackground`または`oshiBackgroundSecondary`を使用する
