# Implementation Plan

## Phase 1: データ層とセリフ管理の実装

- [x] 1. デフォルトトレーナーの定数データを定義する
- [x] 1.1 デフォルトトレーナー「推乃 愛」のデータ構造を作成する
  - 名前「推乃 愛」、初期レベル1、初期経験値0を定義
  - 画像アセット名"OshiAi"を指定
  - 静的定数として定義し、再利用可能にする
  - _Requirements: 1.1, 1.2, 5.1, 5.2_

- [x] 1.2 ツンデレ性格のテンプレートセリフ管理システムを構築する
  - 状況別セリフカテゴリー（挨拶、トレーニング開始、応援、照れ隠し）を定義
  - 一人称「うち」、二人称「あんた」を含むツンデレセリフを各カテゴリーに3-5個作成
  - カテゴリーに応じたセリフをランダムに取得できる機能を実装
  - 将来のLLM統合を見据えたインターフェース設計
  - _Requirements: 1.3, 1.4, 1.5, 4.1, 4.2, 4.3, 4.4_

- [x] 2. データサービスをデフォルトトレーナーに対応させる
- [x] 2.1 既存のモックデータサービスを拡張する
  - プレースホルダーデータを「推乃 愛」データに置き換え
  - セリフ管理システムと統合し、挨拶セリフを設定
  - データ取得時に完全なトレーナー情報（名前、レベル、経験値、画像名、セリフ）を返す
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

## Phase 2: 透過画像のヒット判定実装

- [x] 3. アルファ値ベースのヒット判定を実装する
- [x] 3.1 タップ座標のアルファ値を取得する機能を作成する
  - UIImageViewをサブクラス化し、カスタムヒット判定をオーバーライド
  - タップ座標をCGImage座標系に変換する処理を実装
  - CGImageのピクセルデータから指定座標のアルファ値を取得
  - アルファ閾値（0.1）未満の場合はタップを無視
  - エラー時は安全にフォールバック（デフォルトで不透明と仮定）
  - _Requirements: 2.5, 2.6_

- [x] 3.2 SwiftUIで使用可能な透過画像ビューを作成する
  - UIViewRepresentableを使用してUIKitのヒット判定をSwiftUIに統合
  - 画像名とタップコールバックを受け取るインターフェース設計
  - タップジェスチャーを適切に処理し、コールバックを呼び出す
  - アセット読み込み失敗時のフォールバック処理（SF Symbol "person.fill"）
  - _Requirements: 2.2, 2.4, 2.5, 2.6_

## Phase 3: キャラクター画像アセットの追加

- [x] 4. 推乃 愛のキャラクター画像をプロジェクトに追加する
- [x] 4.1 透過PNG画像をAssets.xcassetsに配置する
  - "OshiAi"という名前でイメージセットを作成
  - 背景完全透過（アルファ = 0）のPNG画像を用意
  - @1x, @2x, @3x解像度の画像を配置（または1つの画像で自動スケーリング）
  - キャラクター部分のアルファ値が0.5以上であることを確認
  - _Requirements: 2.1, 2.2_

## Phase 4: ホーム画面のUI統合

- [x] 5. ホーム画面でデフォルトトレーナーを表示する
- [x] 5.1 ホーム画面のキャラクター画像表示を透過画像ビューに置き換える
  - 既存のSF Symbolプレースホルダーを透過画像ビューに変更
  - 画像名"OshiAi"を指定
  - タップ時にトレーニングポップアップを表示するコールバックを設定
  - タップ時にセリフを「トレーニング開始」カテゴリーに更新
  - ウマ娘風UIデザインとの調和を維持（配置、スタイリング）
  - _Requirements: 2.1, 2.3, 2.4, 6.1, 6.2, 6.3_

- [x] 5.2 ホーム画面のセリフ更新機能を拡張する
  - セリフ更新メソッドにカテゴリーパラメータを追加
  - 既存の引数なしメソッドを互換性のために維持（デフォルトで「応援」カテゴリー）
  - ホーム画面初期表示時は「挨拶」カテゴリーのセリフを表示
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 6.1, 6.3_

## Phase 5: テストとバリデーション

- [x] 6. データ層とセリフ管理のユニットテストを作成する
- [x] 6.1 デフォルトトレーナーデータの検証テストを実装する
  - 名前が"推乃 愛"であることを検証
  - レベルが1、経験値が0であることを検証
  - 画像名が"OshiAi"であることを検証
  - _Requirements: 1.1, 1.2_

- [x] 6.2 セリフ管理システムのテストを実装する
  - 各カテゴリーで非空のセリフが取得できることを検証
  - 挨拶カテゴリーで「うち」または「あんた」を含むセリフが取得できることを検証
  - すべてのカテゴリーでツンデレ表現が含まれることを検証
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [x] 6.3 データサービス統合のテストを実装する
  - モックサービスから「推乃 愛」データが返されることを検証
  - 返されたデータに完全な情報（名前、レベル、画像名、セリフ）が含まれることを検証
  - セリフが非空でツンデレ性格を反映していることを検証
  - _Requirements: 5.1, 5.2, 5.3_

- [ ] 7. ヒット判定とUI統合のテストを作成する
- [ ] 7.1 アルファ値取得機能のユニットテストを実装する
  - 完全透明ピクセル（アルファ = 0）で0.0を返すことを検証
  - 完全不透明ピクセル（アルファ = 1）で1.0を返すことを検証
  - 半透明ピクセル（アルファ = 0.5）で0.5を返すことを検証
  - _Requirements: 2.5, 2.6_

- [ ] 7.2 ホーム画面とビューモデルの統合テストを実装する
  - ホーム画面初期化時にデフォルトトレーナーが読み込まれることを検証
  - セリフ更新メソッド呼び出しで適切なカテゴリーのセリフが設定されることを検証
  - キャラクター画像、名前、セリフが同時に表示されることを検証
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [ ] 8. UIテストと目視確認を実施する
- [ ] 8.1 ホーム画面の表示とインタラクションをテストする
  - アプリ起動時にホーム画面が正しく表示されることを確認
  - ツンデレセリフがウマ娘風吹き出しスタイルで表示されることを確認
  - キャラクター画像タップでトレーニングポップアップが表示されることを確認
  - タップ時にセリフが更新されることを確認
  - _Requirements: 3.1, 3.2, 3.3, 6.1, 6.3_

- [ ] 8.2 透過画像ヒット判定の動作確認を実施する
  - キャラクター画像の不透明部分タップでポップアップが表示されることを確認
  - 透明部分タップで何も起こらないことを確認
  - ウマ娘風UIデザインとの調和を目視確認（配置、スタイリング、カラーパレット）
  - _Requirements: 2.1, 2.3, 2.4, 2.5, 2.6, 6.2_

- [ ] 9. パフォーマンステストと最適化を実施する
- [ ] 9.1 画像読み込みとレンダリングのパフォーマンスを測定する
  - 画像読み込み時間が50ms以内であることを検証（要件: 100ms以内）
  - ホーム画面初回レンダリング時間が100ms以内であることを検証
  - _Requirements: Non-Functional - パフォーマンス_

- [ ] 9.2 ヒット判定のパフォーマンスを測定する
  - アルファ値取得処理が10ms以内であることを検証
  - 連続タップ時にUI応答性が維持されること（60fps）を確認
  - _Requirements: Non-Functional - パフォーマンス_
