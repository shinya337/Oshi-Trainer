# 実装計画：推しトレーナーテンプレート

## タスク一覧

- [x] 1. 性格タイプ列挙型の実装
  - ツンデレ、元気、優しい、クールの4つの性格タイプを定義
  - 各性格タイプごとのデフォルト一人称を提供
  - 各性格タイプごとのデフォルト二人称を提供
  - 各性格タイプごとのLLM用デフォルトプロンプトを生成
  - String列挙型として定義し、CaseIterableとCodableに準拠
  - _要件: 2.1, 2.5, 2.6, 3.4_

- [x] 2. トレーニング特化列挙型の実装
- [x] 2.1 応援スタイル列挙型の実装
  - 厳しめ、優しめ、バランス型の3つのスタイルを定義
  - 各スタイルごとの厳しさの重み（strictnessWeight）を計算
  - String列挙型として定義し、CaseIterableとCodableに準拠
  - _要件: 5.1, 5.3, 5.5_

- [x] 2.2 フィードバック頻度列挙型の実装
  - 高頻度、中頻度、低頻度の3つの頻度を定義
  - 各頻度ごとのレップ間隔（repInterval）を提供
  - String列挙型として定義し、CaseIterableとCodableに準拠
  - _要件: 5.2, 5.4_

- [x] 3. OshiTrainerTemplateモデルの実装
  - 14個のプロパティを持つ推しトレーナーテンプレートモデルを定義
  - 基本プロフィール（名前、テーマカラー、キャラクター画像）を含める
  - 性格・口調パラメータ（性格タイプ、一人称、二人称、性格説明）を含める
  - LLM統合パラメータ（プロンプト指示、参考口調、禁止ワード）を含める
  - 音声・ボイスパラメータ（キャラクターボイス）を含める
  - トレーニング特化パラメータ（応援スタイル、フィードバック頻度）を含める
  - IdentifiableプロトコルとCodableプロトコルに準拠
  - _要件: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 4.1, 5.1, 5.2, 6.1_

- [x] 4. OshiTrainerとの変換メソッドの実装
- [x] 4.1 OshiTrainerTemplateからOshiTrainerへの変換
  - テンプレートから実行時データへの変換メソッドを実装
  - レベル、経験値、現在のセリフをパラメータとして受け取る
  - デフォルト値（レベル1、経験値0）を提供
  - 既存OshiTrainerモデルのプロパティに正しくマッピング
  - _要件: 6.2_

- [x] 4.2 OshiTrainerからOshiTrainerTemplateへの変換
  - 既存の実行時データからテンプレートへの変換メソッドを実装
  - 既存テンプレート情報をオプションパラメータとして受け取る
  - テンプレートがnilの場合、全プロパティにデフォルト値を設定
  - テーマカラーはデフォルト「pink」を使用
  - 性格タイプはデフォルト「cheerful」を使用
  - 一人称・二人称は性格タイプのデフォルト値を使用
  - キャラクターボイスはデフォルト「ずんだもん」を使用
  - 応援スタイルはデフォルト「balanced」を使用
  - フィードバック頻度はデフォルト「medium」を使用
  - _要件: 1.5, 1.6, 2.5, 2.6, 3.4, 3.5, 4.3, 5.3, 5.4, 6.2_

- [x] 5. 動的テーマカラー機能の実装
  - Color+Oshi extensionにテーマカラー文字列からColorへの変換メソッドを追加
  - pink、blue、green、orange、purpleの5色をサポート
  - 大文字小文字を区別しない識別子マッピング
  - 不正な識別子の場合はデフォルトカラー（pink）にフォールバック
  - グラデーション用の薄いバリエーション（透明度0.6）を提供
  - 既存の静的カラー定義は変更しない
  - _要件: 1.5, 1.7, 1.8_

- [x] 6. ユニットテストの実装
- [x] 6.1 PersonalityType列挙型のテスト
  - 各性格タイプのデフォルト一人称が正しいことを検証
  - 各性格タイプのデフォルト二人称が正しいことを検証
  - 各性格タイプのデフォルトプロンプトが空でないことを検証
  - 全ケースがCaseIterableで列挙可能であることを検証
  - _要件: 2.5, 2.6, 3.4_

- [x] 6.2 EncouragementStyleとFeedbackFrequency列挙型のテスト
  - 応援スタイルの厳しさの重みが正しいことを検証
  - フィードバック頻度のレップ間隔が正しいことを検証
  - 全ケースがCaseIterableで列挙可能であることを検証
  - _要件: 5.5_

- [x] 6.3 OshiTrainerTemplate変換メソッドのテスト
  - toOshiTrainer()メソッドがプロパティを正しくマッピングすることを検証
  - fromOshiTrainer()メソッドがテンプレートありの場合に既存値を保持することを検証
  - fromOshiTrainer()メソッドがテンプレートnilの場合にデフォルト値を設定することを検証
  - デフォルト値が要件定義通りに設定されることを検証
  - _要件: 1.5, 1.6, 2.5, 2.6, 3.4, 3.5, 4.3, 5.3, 5.4, 6.2_

- [x] 6.4 Color+Oshi動的テーマカラーのテスト
  - oshiThemeColor(from: "pink")が正しいカラーを返すことを検証
  - oshiThemeColor(from: "invalid")がデフォルトカラーを返すことを検証
  - 大文字小文字を区別しないマッピングが機能することを検証
  - oshiThemeColorLight(from:)が透明度0.6のカラーを返すことを検証
  - _要件: 1.5, 1.7, 1.8_

- [x] 7. 統合テストの実装
- [x] 7.1 OshiTrainerTemplate ↔ OshiTrainer変換フローのテスト
  - テンプレート作成 → toOshiTrainer()変換 → プロパティ検証の一連のフローをテスト
  - 既存OshiTrainer → fromOshiTrainer()変換 → デフォルト値検証の一連のフローをテスト
  - 双方向変換の整合性を検証
  - _要件: 6.2_

- [x] 7.2 PersonalityTypeとデフォルト値連携のテスト
  - ツンデレ性格タイプで一人称「うち」、二人称「あんた」が設定されることを検証
  - 元気性格タイプで一人称「私」、二人称「あなた」が設定されることを検証
  - 性格タイプ変更時のデフォルト値自動更新を検証
  - _要件: 2.5, 2.6_

- [x] 8. UI統合の実装
- [x] 8.1 DefaultOshiTrainerDataにテンプレート追加
  - 推乃 愛のOshiTrainerTemplateを追加
  - _要件: 1.1, 1.2, 1.3_

- [x] 8.2 HomeViewModelにテンプレート管理機能追加
  - oshiTemplateプロパティを追加
  - _要件: 1.7, 1.8_

- [x] 8.3 動的テーマカラーの適用
  - HomeViewの背景グラデーションに動的テーマカラーを適用
  - ボタンスタイルに動的テーマカラーを適用
  - NavigationTitleに動的テーマカラーを適用（LevelDetailView、StatisticsView、SettingsView）
  - _要件: 1.7, 1.8_
