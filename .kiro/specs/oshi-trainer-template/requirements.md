# Requirements Document

## はじめに

本仕様は、将来的な「推し作成機能」と「推しからのメッセージ機能（LLM統合）」の実装基盤となる、推しトレーナーのテンプレート化を目的としています。参考アプリ「推しトーク」の入力項目を分析しつつ、Oshi-Trainerの特性（トレーニングコンパニオン、モチベーション向上）に最適化された入力項目を定義します。

### ビジネス価値
- 将来の推し作成機能の実装における入力項目の明確化
- LLM統合時に必要なパラメータの整理
- 既存の`OshiTrainer`モデルから拡張可能な設計

## 要件

### 要件1: 基本プロフィール項目の定義
**目的:** トレーニングアプリのユーザーとして、推しトレーナーの基本的なプロフィールを設定できるようにし、パーソナライズされたトレーニング体験を得られるようにする。

#### 受け入れ基準

1. WHEN ユーザーが推しトレーナーを作成する際、Oshi-Trainerシステム SHALL 「推しの名前」入力フィールドを提供する
2. WHEN ユーザーが推しトレーナーを作成する際、Oshi-Trainerシステム SHALL 「テーマカラー」選択フィールドを提供する
3. WHEN ユーザーが推しトレーナーを作成する際、Oshi-Trainerシステム SHALL 「キャラクター画像」（立ち絵）アップロードフィールドを提供する
4. IF ユーザーが「推しの名前」を未入力のまま保存しようとした場合、Oshi-Trainerシステム SHALL エラーメッセージを表示し保存を中止する
5. IF ユーザーが「テーマカラー」を未選択のまま保存しようとした場合、Oshi-Trainerシステム SHALL デフォルトカラー（ピンク）を自動設定する
6. IF ユーザーが「キャラクター画像」を未設定のまま保存しようとした場合、Oshi-Trainerシステム SHALL デフォルト画像を自動設定する
7. WHEN 推しトレーナーのテーマカラーが設定されている場合、Oshi-Trainerシステム SHALL ホーム画面の以下のUI要素にテーマカラーを適用する:
   - 設定ボタン、推しボタン、統計ボタンのアクセントカラー
   - 背景グラデーションカラー
8. WHEN 推しトレーナーのテーマカラーが設定されている場合、Oshi-Trainerシステム SHALL 各種画面（レベル詳細、統計、設定など）のタイトルテキストにテーマカラーを適用する

### 要件2: 性格・口調パラメータの定義
**目的:** トレーニングアプリのユーザーとして、推しトレーナーの性格と口調をカスタマイズし、自分の好みに合った応援スタイルでトレーニングできるようにする。

#### 受け入れ基準

1. WHEN ユーザーが推しトレーナーを作成する際、Oshi-Trainerシステム SHALL 「性格タイプ」選択フィールド（例: ツンデレ、元気、優しい、クール）を提供する
2. WHEN ユーザーが推しトレーナーを作成する際、Oshi-Trainerシステム SHALL 「一人称」入力フィールド（例: うち、私、俺、僕）を提供する
3. WHEN ユーザーが推しトレーナーを作成する際、Oshi-Trainerシステム SHALL 「二人称」（ユーザーへの呼び方）入力フィールド（例: あんた、あなた、君、お前）を提供する
4. WHEN ユーザーが推しトレーナーを作成する際、Oshi-Trainerシステム SHALL 「性格説明」テキストエリアを提供する（LLM統合時のプロンプト生成用）
5. IF ユーザーが「性格タイプ」を未選択のまま保存しようとした場合、Oshi-Trainerシステム SHALL デフォルト性格（元気）を自動設定する
6. IF ユーザーが「一人称」「二人称」を未入力のまま保存しようとした場合、Oshi-Trainerシステム SHALL 性格タイプに応じたデフォルト値を自動設定する

### 要件3: LLM統合パラメータの定義（非リアルタイム用途）
**目的:** 開発者として、将来のLLM統合時に性格ベースのメッセージ生成を実現するため、必要なパラメータを定義する。LLM統合は、推し作成時のテンプレートセリフ生成、トレーニングお誘い通知、トレーニング後の励ましメッセージなど、非リアルタイム用途に限定する。

**注記:** トレーニング中のリアルタイムフィードバック（フォーム解析、レップカウント、速度判定）は、レイテンシの観点からLLMを使用せず、テンプレートベースの音声・テキストで対応する。

#### 受け入れ基準

1. WHEN ユーザーが推しトレーナーを作成する際、Oshi-Trainerシステム SHALL 「プロンプト指示」テキストエリアを提供する（LLMへの振る舞い指示用、非リアルタイムメッセージ生成に使用）
2. WHEN ユーザーが推しトレーナーを作成する際、Oshi-Trainerシステム SHALL 「参考口調」テキストエリアを提供する（LLMの出力スタイル学習用）
3. WHEN ユーザーが推しトレーナーを作成する際、Oshi-Trainerシステム SHALL 「禁止ワード」リスト入力フィールドを提供する（LLM出力フィルタリング用）
4. IF ユーザーが「プロンプト指示」を未入力のまま保存した場合、Oshi-Trainerシステム SHALL 性格タイプと性格説明から自動生成したデフォルトプロンプトを設定する
5. IF ユーザーが「参考口調」を未入力のまま保存した場合、Oshi-Trainerシステム SHALL 性格タイプに応じたデフォルト口調テンプレートを設定する
6. WHEN LLM統合を実装する際、Oshi-Trainerシステム SHALL 以下の用途に限定する:
   - 推し作成時の性格ベースセリフテンプレート生成
   - トレーニングお誘い通知メッセージ生成
   - トレーニング完了後の励ましメッセージ生成

### 要件4: 音声・ボイスパラメータの定義
**目的:** トレーニングアプリのユーザーとして、推しトレーナーの音声を選択し、聴覚的なフィードバックを通じてトレーニングモチベーションを高められるようにする。

#### 受け入れ基準

1. WHEN ユーザーが推しトレーナーを作成する際、Oshi-Trainerシステム SHALL 「キャラクターボイス（CV）」選択フィールドを提供する
2. WHEN ユーザーが「キャラクターボイス（CV）」を選択する際、Oshi-Trainerシステム SHALL 利用可能な音声アセット一覧（例: ずんだもん、VOICEVOX対応キャラクター）を表示する
3. IF ユーザーが「キャラクターボイス（CV）」を未選択のまま保存した場合、Oshi-Trainerシステム SHALL デフォルト音声（ずんだもん）を自動設定する
4. WHERE 音声再生機能が実装されている場合、Oshi-Trainerシステム SHALL 選択された音声のサンプル再生機能を提供する

### 要件5: トレーニング特化パラメータの定義
**目的:** トレーニングアプリのユーザーとして、推しトレーナーのトレーニング応援スタイルをカスタマイズし、自分に最適な応援方法でトレーニングを継続できるようにする。

**注記:** これらのパラメータは、トレーニング中のテンプレートベースフィードバックの選択や、非リアルタイムのLLMメッセージ生成時のスタイル制御に使用される。

#### 受け入れ基準

1. WHEN ユーザーが推しトレーナーを作成する際、Oshi-Trainerシステム SHALL 「応援スタイル」選択フィールド（例: 厳しめ、優しめ、バランス型）を提供する
2. WHEN ユーザーが推しトレーナーを作成する際、Oshi-Trainerシステム SHALL 「フィードバック頻度」選択フィールド（例: 高頻度、中頻度、低頻度）を提供する
3. IF ユーザーが「応援スタイル」を未選択のまま保存した場合、Oshi-Trainerシステム SHALL デフォルト（バランス型）を自動設定する
4. IF ユーザーが「フィードバック頻度」を未選択のまま保存した場合、Oshi-Trainerシステム SHALL デフォルト（中頻度）を自動設定する
5. WHEN トレーニング中のフィードバックを提供する際、Oshi-Trainerシステム SHALL 「応援スタイル」設定に基づいてテンプレートセリフを選択する
6. WHEN 非リアルタイムメッセージ（お誘い通知、トレーニング後励まし）を生成する際、Oshi-Trainerシステム SHALL 「応援スタイル」「フィードバック頻度」をLLMプロンプトに反映する

### 要件6: データモデル拡張
**目的:** 開発者として、既存の`OshiTrainer`モデルを拡張し、推しトレーナーテンプレートの全入力項目を保持できるデータ構造を定義する。

#### 受け入れ基準

1. WHEN 推しトレーナーテンプレートを実装する際、Oshi-Trainerシステム SHALL 以下のプロパティを持つ`OshiTrainerTemplate`モデルを定義する:
   - `id: UUID` (識別子)
   - `name: String` (推しの名前)
   - `themeColor: String` (テーマカラー)
   - `characterImage: String` (キャラクター画像名またはURL)
   - `personalityType: String` (性格タイプ)
   - `firstPerson: String` (一人称)
   - `secondPerson: String` (二人称)
   - `personalityDescription: String` (性格説明)
   - `llmPrompt: String` (プロンプト指示)
   - `referenceTone: String` (参考口調)
   - `prohibitedWords: [String]` (禁止ワードリスト)
   - `characterVoice: String` (キャラクターボイス)
   - `encouragementStyle: String` (応援スタイル)
   - `feedbackFrequency: String` (フィードバック頻度)

2. WHEN `OshiTrainerTemplate`モデルを定義する際、Oshi-Trainerシステム SHALL 既存の`OshiTrainer`モデルとの変換メソッドを提供する

### 要件7: 推しトーク入力項目との対応関係
**目的:** 開発者として、参考アプリ「推しトーク」の入力項目とOshi-Trainerの入力項目の対応関係を明確にし、既存のベストプラクティスを活用する。

#### 受け入れ基準

1. WHEN 推しトレーナーテンプレートを設計する際、Oshi-Trainerシステム SHALL 以下の対応関係を維持する:
   - 推しトーク「推しの名前」 → Oshi-Trainer「推しの名前」
   - 推しトーク「推しの1人称」 → Oshi-Trainer「一人称」
   - 推しトーク「推しに呼んでほしい名前」 → Oshi-Trainer「二人称」
   - 推しトーク「推しのプロフィール」 → Oshi-Trainer「性格説明」
   - 推しトーク「推しへの指示」 → Oshi-Trainer「プロンプト指示」
   - 推しトーク「参考口調」 → Oshi-Trainer「参考口調」
   - 推しトーク「禁止ワード」 → Oshi-Trainer「禁止ワード」

2. WHEN 推しトレーナーテンプレートを設計する際、Oshi-Trainerシステム SHALL 以下のOshi-Trainer独自項目を追加する:
   - 「性格タイプ」（プリセット選択による入力簡略化）
   - 「テーマカラー」（UIカスタマイズ）
   - 「キャラクターボイス」（音声フィードバック）
   - 「応援スタイル」（トレーニング特化）
   - 「フィードバック頻度」（トレーニング特化）

3. WHERE 推しトークの「アイコン画像」「トーク背景画像」に相当する項目、Oshi-Trainerシステム SHALL 「キャラクター画像」（立ち絵）として統合する
