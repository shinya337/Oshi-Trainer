# 実装計画

## 概要

この実装計画は、ホーム画面UI改善機能を段階的に実装するためのタスク一覧です。各タスクは1-3時間程度で完了できるサイズに分割されており、順番に実装することで機能を完成させます。

---

- [x] 1. 推し追加プレースホルダー画像アセットの追加
  - `/image/oshi_create.png` を Xcode プロジェクトの `Assets.xcassets` に追加
  - アセット名を `oshi_create` に設定
  - 画像が正しく読み込まれることをプレビューで確認
  - _Requirements: 5.1, 5.5_

- [x] 2. HomeViewModel の推しトレーナーリスト管理機能を実装
- [x] 2.1 推しトレーナーリストと選択中インデックスの状態管理を追加
  - デフォルトトレーナーと推し追加プレースホルダーを含むリストを管理
  - 現在選択中のトレーナーインデックスを管理
  - 推し追加プレースホルダー専用の UUID を定義
  - 推し追加プレースホルダー判定機能を実装
  - _Requirements: 4.5, 5.1_

- [x] 2.2 現在選択中のトレーナーデータを取得する機能を実装
  - 現在選択中のトレーナーを返す計算プロパティを実装
  - 現在選択中のトレーナーテンプレートを返す計算プロパティを実装
  - インデックス範囲外の場合のフォールバック処理を実装
  - _Requirements: 4.3_

- [x] 2.3 推しトレーナーリストの初期化処理を実装
  - デフォルトトレーナー「推乃 愛」のデータを読み込み
  - 推し追加プレースホルダーのデータを生成
  - リストに両方を追加して初期化
  - 初期セリフを設定
  - _Requirements: 4.5, 5.1_

- [x] 3. 推しトレーナー詳細画面（TrainerDetailView）を実装
- [x] 3.1 詳細画面の基本レイアウトを作成
  - NavigationStack と ZStack を使用した画面構造を構築
  - ウマ娘風背景色を適用
  - モーダル表示用の dismiss 環境変数を設定
  - _Requirements: 1.1, 1.2_

- [x] 3.2 キャラクター画像の丸アイコン表示を実装
  - テンプレートのキャラクター画像を円形にクリップ
  - テーマカラーの枠線を追加
  - シャドウ効果を適用
  - _Requirements: 1.3_

- [x] 3.3 詳細情報の表示レイアウトを実装
  - 名前、イメージカラー、一人称、二人称、性格、ボイス情報を表示
  - DetailRow コンポーネントを作成（ラベルと値のペア表示）
  - イメージカラーは色サークルと名前で表示
  - 背景カードスタイルを適用
  - _Requirements: 1.4, 1.5, 1.6, 1.7, 1.8, 1.9_

- [x] 3.4 閉じるボタンを実装
  - ウマ娘風のボタンスタイルを適用
  - タップ時に dismiss() を呼び出して画面を閉じる
  - _Requirements: 1.10_

- [x] 4. HomeView のスワイプ切り替え機能を実装
- [x] 4.1 TabView によるスワイプ切り替えレイアウトを構築
  - TabView を使用してキャラクター画像をページング可能に
  - viewModel の currentTrainerIndex とバインディング
  - ページインジケーターを非表示に設定
  - _Requirements: 4.1, 4.2, 4.4_

- [x] 4.2 キャラクター画像レイヤーの切り替え対応を実装
  - ForEach でトレーナーリストをループ
  - 各トレーナーに対応する画像レイヤーを生成
  - tag を使用してインデックスを紐付け
  - _Requirements: 4.3_

- [x] 4.3 通常トレーナーと推し追加プレースホルダーの表示分岐を実装
  - isAddPlaceholder() で判定
  - 通常トレーナーは TransparentImageView を使用
  - 推し追加プレースホルダーは oshi_create 画像を使用
  - _Requirements: 5.1, 5.5_

- [x] 5. キャラクター画像タップ時の挙動を変更
- [x] 5.1 詳細画面表示の状態管理を追加
  - showTrainerDetail 状態変数を追加
  - .sheet モディファイアで TrainerDetailView を表示
  - 現在のトレーナーとテンプレートを渡す
  - _Requirements: 1.1, 1.2_

- [x] 5.2 通常トレーナータップ時の詳細画面表示を実装
  - TransparentImageView の onTap で showTrainerDetail を true に
  - 既存のトレーニング選択画面表示処理を削除
  - _Requirements: 1.1_

- [x] 5.3 推し追加プレースホルダータップ時の導線を実装
  - プレースホルダー画像タップ時のハンドラーを追加
  - 推し追加ビューへの遷移処理を実装（現時点ではログ出力）
  - _Requirements: 5.2_

- [x] 6. メッセージエリアのタップ処理を実装
- [x] 6.1 メッセージエリアをタップ可能にする
  - 通常トレーナーの場合、メッセージテキストに .onTapGesture を追加
  - タップ時にトレーニング選択画面を表示
  - タップ時にセリフを「トレーニング開始」カテゴリに更新
  - _Requirements: 2.1, 2.2, 2.3_

- [x] 6.2 推し追加プレースホルダーの「キャラを作成する」ボタンを実装
  - プレースホルダー表示時、メッセージエリアにボタンを表示
  - ボタンテキストを「キャラを作成する」に設定
  - ボタンタップ時に推し追加ビューへ遷移（現時点ではログ出力）
  - ウマ娘風のボタンスタイルを適用
  - _Requirements: 5.3, 5.4_

- [x] 7. フッターのナビゲーションボタンを削除
- [x] 7.1 統計ボタンと推しボタンを削除
  - footerView 全体を削除
  - セリフ欄の下部パディングを調整（footerView 削除による余白調整）
  - _Requirements: 3.1, 3.2_

- [x] 8. 動的テーマカラーグラデーション背景の更新
- [x] 8.1 現在選択中のトレーナーに応じてテーマカラーを変更
  - viewModel.currentTemplate.themeColor を使用
  - TabView 切り替え時にグラデーション背景が更新されることを確認
  - _Requirements: 4.3_

- [ ] 9. ユニットテストの実装
- [ ] 9.1 HomeViewModel のテストを実装
  - loadTrainers() のテスト（デフォルトトレーナーとプレースホルダーの読み込み）
  - isAddPlaceholder() のテスト（正しく判定されるか）
  - currentTrainer と currentTemplate のテスト（インデックスに応じた取得）
  - updateDialogue() のテスト（セリフ更新ロジック）
  - _Requirements: 全要件（ビジネスロジックの検証）_

- [ ] 9.2 TrainerDetailView のテストを実装
  - 詳細情報が正しく表示されるかのテスト
  - 閉じるボタンの動作テスト
  - _Requirements: 1.1-1.10_

- [ ] 10. 統合テストとUIテストの実装
- [ ] 10.1 統合テストを実装
  - スワイプ切り替えのテスト（TabView の動作）
  - 詳細画面表示のテスト（画像タップ時）
  - トレーニング選択画面表示のテスト（メッセージタップ時）
  - 推し追加プレースホルダータップのテスト
  - フッター削除の確認テスト
  - _Requirements: 全要件_

- [ ] 10.2 UIテストを実装
  - ホーム画面レンダリングのテスト
  - スワイプジェスチャーのテスト
  - 詳細画面インタラクションのテスト
  - 推し追加プレースホルダー表示のテスト
  - _Requirements: 全要件（UI動作の検証）_

- [ ] 11. 動作確認とバグ修正
- [ ] 11.1 実機/シミュレータでの動作確認
  - すべての要件が満たされているかを確認
  - スワイプ操作のスムーズさを確認
  - 画面遷移が正しく動作するかを確認
  - テーマカラーが正しく反映されるかを確認
  - _Requirements: 全要件_

- [ ] 11.2 バグ修正とリファクタリング
  - 発見されたバグを修正
  - コードの可読性を改善
  - パフォーマンスの最適化
  - _Requirements: 全要件_
